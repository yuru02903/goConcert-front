import{al as q,S as $,T as v,R as D,r as T,ae as A,W as I,X as N,Y as R,Z as o,ab as E,c as r,a9 as c,aa as n,a4 as p,ai as L,_ as M,am as W,af as m,a0 as j,a2 as U,V as C,a1 as h}from"./index-6859542d.js";import{c as X,a as u,d as Y,e as V,f as Z,V as z}from"./index.esm-1d8a1b1e.js";import{u as H,a as s}from"./vee-validate.esm-c57ecf30.js";import{a as f,V as J}from"./VList-968969b0.js";import{V as K,a as d}from"./VRow-10742534.js";import{V as _}from"./VDivider-5126788b.js";import{V as O}from"./VSelect-c690572f.js";import{V as Q}from"./VCheckbox-a66258a9.js";import"./VSlideGroup-0877d4d9.js";const ee={style:{"font-weight":"500"}},re=c("h2",{style:{"margin-top":"30px"}},"聯絡資訊",-1),me={__name:"PayView",setup(te){const k=q(),P=$(),{api:w,apiAuth:b}=E(),g=v();D();const x=["信用卡","轉帳","linepay"],a=T({_id:"",name:"",date:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!0});A(async()=>{var e,i;try{const{data:t}=await w.get("/tickets/"+k.params.id);a.value._id=t.result._id,a.value.name=t.result.name,a.value.date=t.result.date,a.value.performer=t.result.performer,a.value.originalPrice=t.result.originalPrice,a.value.price=t.result.price,a.value.description=t.result.description,a.value.categoryCountry=t.result.categoryCountry,a.value.categoryGroup=t.result.categoryGroup,a.value.sell=t.result.sell,document.title=`GoConcert - ${a.value.name}`}catch(t){const l=((i=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:i.message)||"發生錯誤，請稍後再試";g({text:l,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),P.push("/")}});const G=X({name:u().required("缺少演唱會名稱"),date:Y().required("缺少演唱會日期").min(new Date,"日期須大於今天"),performer:u().required("缺少表演者名稱"),originalPrice:V().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:V().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:u(),categoryCountry:u().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",e=>CategoryCountry.includes(e)),categoryGroup:u().required("請選擇表演者性質").test("isCategoryGroup","表演者性質有誤",e=>CategoryGroup.includes(e)),sell:Z()}),{handleSubmit:S,isSubmitting:y,resetForm:ae}=H({validationSchema:G,initialValues:{name:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!1}});s("name"),s("date"),s("performer"),s("originalPrice"),s("price"),s("description"),s("categoryCountry"),s("categoryGroup"),s("sell");const B=S(async e=>{var i,t;try{dialogId.value===""?await b.post("/tickets",{name:e.name,date:e.date,performer:e.performer,originalPrice:e.originalPrice,price:e.price,description:e.description,categoryCountry:e.categoryCountry,categoryGroup:e.categoryGroup,sell:e.sell}):await b.patch("/tickets/"+dialogId.value,{name:e.name,date:e.date,performer:e.performer,originalPrice:e.originalPrice,price:e.price,description:e.description,categoryCountry:e.categoryCountry,categoryGroup:e.categoryGroup,sell:e.sell}),g({text:dialogId.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),closeDialog(),tableApplySearch()}catch(l){console.log(l);const F=((t=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";g({text:F,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(e,i)=>{const t=I("container");return N(),R(t,{style:{"align-items":"center",width:"90%","justify-content":"center",display:"flex","margin-top":"10px"}},{default:o(()=>[r(J,{style:{width:"800px","background-color":"rgba(256, 256, 256, 0.8)"}},{default:o(()=>[r(f,null,{default:o(()=>[r(K,null,{default:o(()=>[r(d,{cols:"12"},{default:o(()=>[c("h1",null,n(a.value.name),1)]),_:1}),r(_),r(d,{cols:"6"},{default:o(()=>[c("h3",null,"表演者："+n(a.value.performer),1)]),_:1}),r(d,{cols:"6"},{default:o(()=>[c("h3",null,"原價："+n(a.value.originalPrice),1)]),_:1}),r(d,{cols:"12"},{default:o(()=>[c("h3",null,"演出日期："+n(a.value.date),1)]),_:1}),r(_),r(d,{cols:"12"},{default:o(()=>[c("h2",ee,"售價：NT$ "+n(a.value.price),1)]),_:1})]),_:1})]),_:1}),r(_),r(f,{style:{"background-color":"#FFFBE6"}}),r(f,null,{default:o(()=>[r(z,{disabled:p(y),onSubmit:L(p(B),["prevent"])},{default:o(()=>[r(M,null,{default:o(()=>[re,r(W,null,{default:o(()=>[r(m,{label:"收件人姓名","error-messages":"請輸入姓名"}),r(m,{label:"連絡電話",type:"number","error-messages":"請輸入電話"}),r(m,{label:"電子信箱","error-messages":"請輸入電子信箱"}),r(m,{label:"地址","error-messages":"請輸入地址"}),r(O,{label:"付款方式",items:x,"error-messages":"請選擇付款方式"}),r(Q,{label:"我以閱讀並同意服務條款","error-messages":"請勾選"})]),_:1}),r(j,null,{default:o(()=>[r(U),r(C,{color:"red",disabled:p(y),onClick:e.closeDialog},{default:o(()=>[h("返回")]),_:1},8,["disabled","onClick"]),r(C,{color:"green",type:"submit",loading:p(y)},{default:o(()=>[h("確認送出訂單")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})}}};export{me as default};
