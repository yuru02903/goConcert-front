import{p as xe,ap as we,aq as ke,g as Ce,ar as Pe,K as Ue,as as Se,l as te,r as f,s as Fe,at as Me,am as Be,w as Y,au as Ie,u as De,av as Te,aw as de,ax as Ae,c as e,ay as Re,a as J,F as ue,o as ve,q as $e,az as qe,aA as Ne,G as _e,C as ne,aB as He,B as he,aC as ze,T as Ee,X as q,$ as Ge,Z as r,a8 as Le,ab as Oe,_ as ce,V as L,a1 as Z,af as d,ag as Ke,Y as G,a6 as je,a4 as t,aj as Xe,a3 as Ye,aa as Ze,an as Je,a2 as me,a0 as fe,a9 as ye,a5 as Qe}from"./index-677308fb.js";import{c as We,a as N,e as ea,f as ge,g as aa,u as la,b}from"./index.esm-48f1a928.js";import{V as oe}from"./VRow-4d2e5ac7.js";import{V as s}from"./VCol-1f3ac925.js";import{V as ta}from"./VDivider-d8cfd718.js";import{V as oa,c as Ve,a as ie}from"./VList-89e46962.js";import{V as ra}from"./VDataTableServer-299a0073.js";import{V as ua}from"./VForm-8504ae8a.js";import{V as re}from"./VSelect-7702c734.js";import{V as sa}from"./VCheckbox-12bc21e1.js";import"./VPagination-0d6f2597.js";import"./VSlideGroup-53381ab9.js";const na=xe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:o=>!isNaN(parseFloat(o))},maxRows:{type:[Number,String],validator:o=>!isNaN(parseFloat(o))},suffix:String,modelModifiers:Object,...we(),...ke()},"VTextarea"),pe=Ce()({name:"VTextarea",directives:{Intersect:Pe},inheritAttrs:!1,props:na(),emits:{"click:control":o=>!0,"mousedown:control":o=>!0,"update:focused":o=>!0,"update:modelValue":o=>!0},setup(o,O){let{attrs:_,emit:H,slots:v}=O;const c=Ue(o,"modelValue"),{isFocused:F,focus:K,blur:Q}=Se(o),W=te(()=>typeof o.counterValue=="function"?o.counterValue(c.value):(c.value||"").toString().length),ee=te(()=>{if(_.maxlength)return _.maxlength;if(!(!o.counter||typeof o.counter!="number"&&typeof o.counter!="string"))return o.counter});function se(n,y){var i,m;!o.autofocus||!n||(m=(i=y[0].target)==null?void 0:i.focus)==null||m.call(i)}const ae=f(),B=f(),le=Fe(""),C=f(),I=te(()=>o.persistentPlaceholder||F.value||o.active);function U(){var n;C.value!==document.activeElement&&((n=C.value)==null||n.focus()),F.value||K()}function D(n){U(),H("click:control",n)}function T(n){H("mousedown:control",n)}function A(n){n.stopPropagation(),U(),ne(()=>{c.value="",He(o["onClick:clear"],n)})}function R(n){var i;const y=n.target;if(c.value=y.value,(i=o.modelModifiers)!=null&&i.trim){const m=[y.selectionStart,y.selectionEnd];ne(()=>{y.selectionStart=m[0],y.selectionEnd=m[1]})}}const g=f(),P=f(+o.rows),S=te(()=>["plain","underlined"].includes(o.variant));Me(()=>{o.autoGrow||(P.value=+o.rows)});function V(){o.autoGrow&&ne(()=>{if(!g.value||!B.value)return;const n=getComputedStyle(g.value),y=getComputedStyle(B.value.$el),i=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),m=g.value.scrollHeight,M=parseFloat(n.lineHeight),h=Math.max(parseFloat(o.rows)*M+i,parseFloat(y.getPropertyValue("--v-input-control-height"))),j=parseFloat(o.maxRows)*M+i||1/0,x=ze(m??0,h,j);P.value=Math.floor((x-i)/M),le.value=he(x)})}Be(V),Y(c,V),Y(()=>o.rows,V),Y(()=>o.maxRows,V),Y(()=>o.density,V);let p;return Y(g,n=>{n?(p=new ResizeObserver(V),p.observe(g.value)):p==null||p.disconnect()}),Ie(()=>{p==null||p.disconnect()}),De(()=>{const n=!!(v.counter||o.counter||o.counterValue),y=!!(n||v.details),[i,m]=Te(_),{modelValue:M,...h}=de.filterProps(o),j=Ae(o);return e(de,J({ref:ae,modelValue:c.value,"onUpdate:modelValue":x=>c.value=x,class:["v-textarea v-text-field",{"v-textarea--prefixed":o.prefix,"v-textarea--suffixed":o.suffix,"v-text-field--prefixed":o.prefix,"v-text-field--suffixed":o.suffix,"v-textarea--auto-grow":o.autoGrow,"v-textarea--no-resize":o.noResize||o.autoGrow,"v-input--plain-underlined":S.value},o.class],style:o.style},i,h,{centerAffix:P.value===1&&!S.value,focused:F.value}),{...v,default:x=>{let{id:z,isDisabled:E,isDirty:$,isReadonly:X,isValid:u}=x;return e(Re,J({ref:B,style:{"--v-textarea-control-height":le.value},onClick:D,onMousedown:T,"onClick:clear":A,"onClick:prependInner":o["onClick:prependInner"],"onClick:appendInner":o["onClick:appendInner"]},j,{id:z.value,active:I.value||$.value,centerAffix:P.value===1&&!S.value,dirty:$.value||o.dirty,disabled:E.value,focused:F.value,error:u.value===!1}),{...v,default:l=>{let{props:{class:a,...w}}=l;return e(ue,null,[o.prefix&&e("span",{class:"v-text-field__prefix"},[o.prefix]),ve(e("textarea",J({ref:C,class:a,value:c.value,onInput:R,autofocus:o.autofocus,readonly:X.value,disabled:E.value,placeholder:o.placeholder,rows:o.rows,name:o.name,onFocus:U,onBlur:Q},w,m),null),[[$e("intersect"),{handler:se},null,{once:!0}]]),o.autoGrow&&ve(e("textarea",{class:[a,"v-textarea__sizer"],id:`${w.id}-sizer`,"onUpdate:modelValue":k=>c.value=k,ref:g,readonly:!0,"aria-hidden":"true"},null),[[qe,c.value]]),o.suffix&&e("span",{class:"v-text-field__suffix"},[o.suffix])])}})},details:y?x=>{var z;return e(ue,null,[(z=v.details)==null?void 0:z.call(v,x),n&&e(ue,null,[e("span",null,null),e(Ne,{active:o.persistentCounter||F.value,value:W.value,max:ee.value},v.counter)])])}:void 0})}),_e({},ae,B,C)}}),ia=ye("h1",null,"票券管理",-1),da=ye("h4",{class:"pb-2 text-red"},"該票券已售出，僅能查看資訊，無法修改",-1),Ca={__name:"TicketsView",setup(o){const{apiAuth:O}=Oe(),_=Ee(),H=f(!1),v=f(""),c=u=>{u?(v.value=u._id,C.value.value=u.name,I.value.value=u.date,U.value.value=u.performer,D.value.value=u.venue,T.value.value=u.area,A.value.value=u.row,R.value.value=u.seat,g.value.value=u.originalPrice,P.value.value=u.price,V.value.value=u.categoryCountry,p.value.value=u.sell,S.value.value=u.description,n.value.value=u.orderStatus):v.value="",H.value=!0},F=()=>{H.value=!1,le()},K=["台灣","韓國","日本","歐美","泰國","其他"],Q=["近走道","靠中間"],W=new Date,ee=new Date(W);ee.setDate(W.getDate()+1);const se=We({name:N().required("缺少演唱會名稱"),date:ea().required("缺少演唱會日期").min(ee,"日期不可小於今天"),performer:N().required("缺少表演者名稱"),venue:N().required("缺少場館名稱"),area:N().required("缺少區域名稱"),row:N().required("缺少排數"),seat:N(),originalPrice:ge().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:ge().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:N(),categoryCountry:N().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",u=>K.includes(u)),sell:aa()}),{handleSubmit:ae,isSubmitting:B,resetForm:le}=la({validationSchema:se,initialValues:{name:"",performer:"",venue:"",area:"",row:"",seat:"",originalPrice:0,price:0,description:"",categoryCountry:"",sell:!1}}),C=b("name"),I=b("date"),U=b("performer"),D=b("venue"),T=b("area"),A=b("row"),R=b("seat"),g=b("originalPrice"),P=b("price"),S=b("description"),V=b("categoryCountry"),p=b("sell"),n=b("orderStatus"),y=ae(async u=>{var l,a;try{v.value===""?await O.post("/tickets",{name:u.name,date:u.date,performer:u.performer,venue:u.venue,area:u.area,row:u.row,seat:u.seat,originalPrice:u.originalPrice,price:u.price,description:u.description,categoryCountry:u.categoryCountry,sell:u.sell,orderStatus:"未售出"}):await O.patch("/tickets/"+v.value,{name:u.name,date:u.date,performer:u.performer,venue:u.venue,area:u.area,row:u.row,seat:u.seat,originalPrice:u.originalPrice,price:u.price,description:u.description,categoryCountry:u.categoryCountry,sell:u.sell}),_({text:v.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),F(),X()}catch(w){console.log(w);const k=((a=(l=w==null?void 0:w.response)==null?void 0:l.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";_({text:k,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),i=f(10),m=f([{key:"createdAt",order:"desc"}]),M=f(1),h=f([]),j=[{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"演出日期",align:"center",sortable:!0,key:"date"},{title:"表演者",align:"center",sortable:!0,key:"performer"},{title:"原價",align:"center",sortable:!0,key:"originalPrice"},{title:"售價",align:"center",sortable:!0,key:"price"},{title:"票券狀態",align:"center",sortable:!0,key:"orderStatus"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯/查看",align:"center",sortable:!1,key:"edit"}],x=f(!0),z=f(0),E=f(""),$=async()=>{var u,l,a,w;x.value=!0;try{const{data:k}=await O.get("/tickets/my",{params:{page:M.value,itemsPerPage:i.value,sortBy:((u=m.value[0])==null?void 0:u.key)||"createdAt",sortOrder:((l=m.value[0])==null?void 0:l.order)==="asc"?1:-1,search:E.value}});console.log(k.result.data),h.value.splice(0,h.value.length,...k.result.data),z.value=k.result.total}catch(k){console.log(k);const be=((w=(a=k==null?void 0:k.response)==null?void 0:a.data)==null?void 0:w.message)||"發生錯誤，請稍後再試";_({text:be,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}x.value=!1};$();const X=()=>{M.value=1,$()};return(u,l)=>(q(),Ge(ue,null,[e(oe,{class:"pa-0 ma-0"},{default:r(()=>[e(s,{cols:"12",class:"pa-8"},{default:r(()=>[ia,e(ta)]),_:1}),e(ce,{class:"mx-auto",width:"80%"},{default:r(()=>[e(oa,null,{default:r(()=>[e(Ve,{value:"UnsoldTickets"},{activator:r(({props:a})=>[e(ie,J(a,{title:"我的票券"}),null,16)]),default:r(()=>[e(ie,null,{default:r(()=>[e(oe,{class:"pt-2"},{default:r(()=>[e(s,{cols:"6"},{default:r(()=>[e(L,{color:"green",onClick:l[0]||(l[0]=a=>c())},{default:r(()=>[Z("新增票券")]),_:1})]),_:1}),e(s,{cols:"6"},{default:r(()=>[e(d,{label:"搜尋","append-icon":"mdi-magnify",density:"comfortable",modelValue:E.value,"onUpdate:modelValue":l[1]||(l[1]=a=>E.value=a),rounded:"",variant:"outlined","onClick:append":X,onKeydown:Ke(X,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(ra,{"items-per-page":i.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>i.value=a),$],"sort-by":m.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>m.value=a),$],page:M.value,"onUpdate:page":[l[4]||(l[4]=a=>M.value=a),$],items:h.value,headers:j,loading:x.value,"items-length":z.value,search:E.value,hover:""},{"item.sell":r(({item:a})=>[a.sell?(q(),G(Qe,{key:0,icon:"mdi-check"})):je("",!0)]),"item.edit":r(({item:a})=>[a.orderStatus==="未售出"?(q(),G(L,{key:0,icon:"mdi-pencil",variant:"text",color:"green",onClick:w=>c(a)},null,8,["onClick"])):(q(),G(L,{key:1,icon:"mdi-eye",variant:"text",color:"grey",onClick:w=>c(a)},null,8,["onClick"]))]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ve,{value:"Admin"},{activator:r(({props:a})=>[e(ie,J(a,{title:"轉讓紀錄"}),null,16)]),_:1})]),_:1})]),_:1})]),_:1}),e(Le,{modelValue:H.value,"onUpdate:modelValue":l[28]||(l[28]=a=>H.value=a),width:"500px"},{default:r(()=>[e(ua,{disabled:t(B),onSubmit:Xe(t(y),["prevent"])},{default:r(()=>[e(ce,null,{default:r(()=>[e(Ye,null,{default:r(()=>[Z(Ze(v.value===""?"新增票券":"編輯票券"),1)]),_:1}),e(Je,null,{default:r(()=>[t(n).value.value==="未售出"?(q(),G(oe,{key:0,"no-gutters":""},{default:r(()=>[e(s,{cols:"12"},{default:r(()=>[e(d,{label:"演唱會名稱",modelValue:t(C).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>t(C).value.value=a),"error-messages":t(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"演唱會日期",type:"date",modelValue:t(I).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>t(I).value.value=a),"error-messages":t(I).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"表演者",modelValue:t(U).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>t(U).value.value=a),"error-messages":t(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"場館",modelValue:t(D).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>t(D).value.value=a),"error-messages":t(D).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"區域",modelValue:t(T).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>t(T).value.value=a),"error-messages":t(T).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"6",class:"pr-2"},{default:r(()=>[e(d,{label:"排",modelValue:t(A).value.value,"onUpdate:modelValue":l[10]||(l[10]=a=>t(A).value.value=a),"error-messages":t(A).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"6",class:"pl-2"},{default:r(()=>[e(re,{label:"座位 (非必選)",items:Q,modelValue:t(R).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>t(R).value.value=a),"error-messages":t(R).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"原始票價",type:"number",min:"0",modelValue:t(g).value.value,"onUpdate:modelValue":l[12]||(l[12]=a=>t(g).value.value=a),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"售價",type:"number",min:"0",modelValue:t(P).value.value,"onUpdate:modelValue":l[13]||(l[13]=a=>t(P).value.value=a),"error-messages":t(P).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(re,{label:"表演者國籍",items:K,modelValue:t(V).value.value,"onUpdate:modelValue":l[14]||(l[14]=a=>t(V).value.value=a),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(pe,{label:"其他說明",modelValue:t(S).value.value,"onUpdate:modelValue":l[15]||(l[15]=a=>t(S).value.value=a),"error-messages":t(S).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(sa,{label:"是否上架",modelValue:t(p).value.value,"onUpdate:modelValue":l[16]||(l[16]=a=>t(p).value.value=a),"error-messages":t(p).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})):(q(),G(oe,{key:1,"no-gutters":""},{default:r(()=>[e(s,{cols:"12"},{default:r(()=>[da]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"演唱會名稱",modelValue:t(C).value.value,"onUpdate:modelValue":l[17]||(l[17]=a=>t(C).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"演唱會日期",type:"date",modelValue:t(I).value.value,"onUpdate:modelValue":l[18]||(l[18]=a=>t(I).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"表演者",modelValue:t(U).value.value,"onUpdate:modelValue":l[19]||(l[19]=a=>t(U).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"場館",modelValue:t(D).value.value,"onUpdate:modelValue":l[20]||(l[20]=a=>t(D).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"區域",modelValue:t(T).value.value,"onUpdate:modelValue":l[21]||(l[21]=a=>t(T).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"6",class:"pr-2"},{default:r(()=>[e(d,{label:"排",modelValue:t(A).value.value,"onUpdate:modelValue":l[22]||(l[22]=a=>t(A).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"6",class:"pl-2"},{default:r(()=>[e(re,{label:"座位 (非必選)",items:Q,modelValue:t(R).value.value,"onUpdate:modelValue":l[23]||(l[23]=a=>t(R).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"原始票價",type:"number",min:"0",modelValue:t(g).value.value,"onUpdate:modelValue":l[24]||(l[24]=a=>t(g).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(d,{label:"售價",type:"number",min:"0",modelValue:t(P).value.value,"onUpdate:modelValue":l[25]||(l[25]=a=>t(P).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(re,{label:"表演者國籍",items:K,modelValue:t(V).value.value,"onUpdate:modelValue":l[26]||(l[26]=a=>t(V).value.value=a),readonly:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:r(()=>[e(pe,{label:"其他說明",modelValue:t(S).value.value,"onUpdate:modelValue":l[27]||(l[27]=a=>t(S).value.value=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}))]),_:1}),t(n).value.value==="未售出"?(q(),G(fe,{key:0,class:"pb-6"},{default:r(()=>[e(me),e(L,{color:"red",disabled:t(B),onClick:F},{default:r(()=>[Z("取消")]),_:1},8,["disabled"]),e(L,{color:"green",type:"submit",loading:t(B)},{default:r(()=>[Z("送出")]),_:1},8,["loading"])]),_:1})):(q(),G(fe,{key:1,class:"pb-6"},{default:r(()=>[e(me),e(L,{color:"gray",onClick:F},{default:r(()=>[Z("關閉")]),_:1})]),_:1}))]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{Ca as default};
