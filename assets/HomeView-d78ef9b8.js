import{c as q,a as i,e as x,f,g as S,u as I,b as r}from"./index.esm-48f1a928.js";import{T as A,r as a,X as $,Y as D,Z as b,ab as F,c as p,_ as L,a9 as E}from"./index-677308fb.js";import{V as N}from"./VRow-4d2e5ac7.js";import{V as T}from"./VDivider-d8cfd718.js";import{V as H}from"./VCol-1f3ac925.js";const O=E("h1",null,"我的資料",-1),M={__name:"HomeView",setup(R){const{apiAuth:n}=F(),l=A(),h=["台灣","韓國","日本","歐美","泰國","其他"],C=["團體","個人"],P=q({name:i().required("缺少演唱會名稱"),date:x().required("缺少演唱會日期").min(new Date,"日期須大於今天"),performer:i().required("缺少表演者名稱"),originalPrice:f().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:f().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:i(),categoryCountry:i().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",e=>h.includes(e)),categoryGroup:i().required("請選擇表演者性質").test("isCategoryGroup","表演者性質有誤",e=>C.includes(e)),sell:S()}),{handleSubmit:_,isSubmitting:X,resetForm:Y}=I({validationSchema:P,initialValues:{name:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!1}});r("name"),r("date"),r("performer"),r("originalPrice"),r("price"),r("description"),r("categoryCountry"),r("categoryGroup"),r("sell"),_(async e=>{var c,s;try{dialogId.value===""?await n.post("/tickets",{name:e.name,date:e.date,performer:e.performer,originalPrice:e.originalPrice,price:e.price,description:e.description,categoryCountry:e.categoryCountry,categoryGroup:e.categoryGroup,sell:e.sell}):await n.patch("/tickets/"+dialogId.value,{name:e.name,date:e.date,performer:e.performer,originalPrice:e.originalPrice,price:e.price,description:e.description,categoryCountry:e.categoryCountry,categoryGroup:e.categoryGroup,sell:e.sell}),l({text:dialogId.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),closeDialog(),G()}catch(o){console.log(o);const t=((s=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";l({text:t,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});const k=a(10),d=a([{key:"createdAt",order:"desc"}]),m=a(1),u=a([]),g=a(!0),w=a(0),V=a(""),y=async()=>{var e,c,s,o;g.value=!0;try{const{data:t}=await n.get("/tickets/my",{params:{page:m.value,itemsPerPage:k.value,sortBy:((e=d.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((c=d.value[0])==null?void 0:c.order)==="asc"?1:-1,search:V.value}});u.value.splice(0,u.value.length,...t.result.data),w.value=t.result.total}catch(t){console.log(t);const B=((o=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";l({text:B,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}g.value=!1};y();const G=()=>{m.value=1,y()};return(e,c)=>($(),D(N,{class:"pa-0 ma-0"},{default:b(()=>[p(H,{cols:"12",class:"pa-8"},{default:b(()=>[O,p(T)]),_:1}),p(L,{class:"mx-auto",width:"80%"})]),_:1}))}};export{M as default};
