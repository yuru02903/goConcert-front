import{p as fe,ap as ge,aq as pe,g as Ve,ar as ye,K as be,as as xe,l as Z,r as m,s as we,at as Ce,an as ke,w as O,au as Pe,u as he,av as Se,aw as se,ax as Fe,c as e,ay as Me,a as K,F as W,o as ne,q as Ue,az as Be,aA as Ie,G as Te,C as le,aB as _e,B as Ae,aC as De,T as Re,X as ue,$ as qe,Z as s,a8 as Ne,ab as $e,_ as ie,V as J,a1 as Q,af as h,ag as He,Y as ze,a6 as Ee,a4 as o,aj as Ge,a3 as Le,aa as Oe,ao as Ke,a0 as je,a2 as Xe,a9 as Ye,a5 as Ze}from"./index-ee21c5dd.js";import{c as Je,a as T,e as Qe,f as de,g as We,u as ea,b as p}from"./index.esm-d526d2cb.js";import{V as re}from"./VRow-c2407045.js";import{V as d}from"./VCol-1ff7b675.js";import{V as aa}from"./VDivider-2483a20b.js";import{V as ta,c as ce,a as oe}from"./VList-8c1de52e.js";import{V as la}from"./VDataTableServer-e7e46bf6.js";import{V as ra}from"./VForm-f87dc042.js";import{V as me}from"./VSelect-0eea4c94.js";import{V as oa}from"./VCheckbox-057d2579.js";import"./VPagination-153f99fd.js";import"./VSlideGroup-8bc9ab4b.js";const sa=fe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:a=>!isNaN(parseFloat(a))},maxRows:{type:[Number,String],validator:a=>!isNaN(parseFloat(a))},suffix:String,modelModifiers:Object,...ge(),...pe()},"VTextarea"),na=Ve()({name:"VTextarea",directives:{Intersect:ye},inheritAttrs:!1,props:sa(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,G){let{attrs:_,emit:A,slots:c}=G;const v=be(a,"modelValue"),{isFocused:S,focus:j,blur:ee}=xe(a),ae=Z(()=>typeof a.counterValue=="function"?a.counterValue(v.value):(v.value||"").toString().length),te=Z(()=>{if(_.maxlength)return _.maxlength;if(!(!a.counter||typeof a.counter!="number"&&typeof a.counter!="string"))return a.counter});function L(n,i){var u,y;!a.autofocus||!n||(y=(u=i[0].target)==null?void 0:u.focus)==null||y.call(u)}const X=m(),w=m(),D=we(""),C=m(),R=Z(()=>a.persistentPlaceholder||S.value||a.active);function F(){var n;C.value!==document.activeElement&&((n=C.value)==null||n.focus()),S.value||j()}function q(n){F(),A("click:control",n)}function N(n){A("mousedown:control",n)}function $(n){n.stopPropagation(),F(),le(()=>{v.value="",_e(a["onClick:clear"],n)})}function H(n){var u;const i=n.target;if(v.value=i.value,(u=a.modelModifiers)!=null&&u.trim){const y=[i.selectionStart,i.selectionEnd];le(()=>{i.selectionStart=y[0],i.selectionEnd=y[1]})}}const V=m(),k=m(+a.rows),M=Z(()=>["plain","underlined"].includes(a.variant));Ce(()=>{a.autoGrow||(k.value=+a.rows)});function U(){a.autoGrow&&le(()=>{if(!V.value||!w.value)return;const n=getComputedStyle(V.value),i=getComputedStyle(w.value.$el),u=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),y=V.value.scrollHeight,B=parseFloat(n.lineHeight),z=Math.max(parseFloat(a.rows)*B+u,parseFloat(i.getPropertyValue("--v-input-control-height"))),I=parseFloat(a.maxRows)*B+u||1/0,P=De(y??0,z,I);k.value=Math.floor((P-u)/B),D.value=Ae(P)})}ke(U),O(v,U),O(()=>a.rows,U),O(()=>a.maxRows,U),O(()=>a.density,U);let g;return O(V,n=>{n?(g=new ResizeObserver(U),g.observe(V.value)):g==null||g.disconnect()}),Pe(()=>{g==null||g.disconnect()}),he(()=>{const n=!!(c.counter||a.counter||a.counterValue),i=!!(n||c.details),[u,y]=Se(_),{modelValue:B,...z}=se.filterProps(a),I=Fe(a);return e(se,K({ref:X,modelValue:v.value,"onUpdate:modelValue":P=>v.value=P,class:["v-textarea v-text-field",{"v-textarea--prefixed":a.prefix,"v-textarea--suffixed":a.suffix,"v-text-field--prefixed":a.prefix,"v-text-field--suffixed":a.suffix,"v-textarea--auto-grow":a.autoGrow,"v-textarea--no-resize":a.noResize||a.autoGrow,"v-input--plain-underlined":M.value},a.class],style:a.style},u,z,{centerAffix:k.value===1&&!M.value,focused:S.value}),{...c,default:P=>{let{id:b,isDisabled:E,isDirty:l,isReadonly:r,isValid:t}=P;return e(Me,K({ref:w,style:{"--v-textarea-control-height":D.value},onClick:q,onMousedown:N,"onClick:clear":$,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},I,{id:b.value,active:R.value||l.value,centerAffix:k.value===1&&!M.value,dirty:l.value||a.dirty,disabled:E.value,focused:S.value,error:t.value===!1}),{...c,default:x=>{let{props:{class:f,...Y}}=x;return e(W,null,[a.prefix&&e("span",{class:"v-text-field__prefix"},[a.prefix]),ne(e("textarea",K({ref:C,class:f,value:v.value,onInput:H,autofocus:a.autofocus,readonly:r.value,disabled:E.value,placeholder:a.placeholder,rows:a.rows,name:a.name,onFocus:F,onBlur:ee},Y,y),null),[[Ue("intersect"),{handler:L},null,{once:!0}]]),a.autoGrow&&ne(e("textarea",{class:[f,"v-textarea__sizer"],id:`${Y.id}-sizer`,"onUpdate:modelValue":ve=>v.value=ve,ref:V,readonly:!0,"aria-hidden":"true"},null),[[Be,v.value]]),a.suffix&&e("span",{class:"v-text-field__suffix"},[a.suffix])])}})},details:i?P=>{var b;return e(W,null,[(b=c.details)==null?void 0:b.call(c,P),n&&e(W,null,[e("span",null,null),e(Ie,{active:a.persistentCounter||S.value,value:ae.value,max:te.value},c.counter)])])}:void 0})}),Te({},X,w,C)}}),ua=Ye("h1",null,"票券管理",-1),wa={__name:"TicketsView",setup(a){const{apiAuth:G}=$e(),_=Re(),A=m(!1),c=m(""),v=l=>{l?(c.value=l._id,w.value.value=l.name,D.value.value=l.date,C.value.value=l.performer,R.value.value=l.venue,F.value.value=l.area,q.value.value=l.row,N.value.value=l.seat,$.value.value=l.originalPrice,H.value.value=l.price,k.value.value=l.categoryCountry,M.value.value=l.sell,V.value.value=l.description):c.value="",A.value=!0},S=()=>{A.value=!1,X()},j=["台灣","韓國","日本","歐美","泰國","其他"],ee=["近走道","靠中間"],ae=Je({name:T().required("缺少演唱會名稱"),date:Qe().required("缺少演唱會日期").min(new Date,"日期須大於今天"),performer:T().required("缺少表演者名稱"),venue:T().required("缺少場館名稱"),area:T().required("缺少區域名稱"),row:T().required("缺少排數"),seat:T(),originalPrice:de().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:de().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:T(),categoryCountry:T().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",l=>j.includes(l)),sell:We()}),{handleSubmit:te,isSubmitting:L,resetForm:X}=ea({validationSchema:ae,initialValues:{name:"",performer:"",venue:"",area:"",row:"",seat:"",originalPrice:0,price:0,description:"",categoryCountry:"",sell:!1}}),w=p("name"),D=p("date"),C=p("performer"),R=p("venue"),F=p("area"),q=p("row"),N=p("seat"),$=p("originalPrice"),H=p("price"),V=p("description"),k=p("categoryCountry"),M=p("sell"),U=te(async l=>{var r,t;try{c.value===""?await G.post("/tickets",{name:l.name,date:l.date,performer:l.performer,venue:l.venue,area:l.area,row:l.row,seat:l.seat,originalPrice:l.originalPrice,price:l.price,description:l.description,categoryCountry:l.categoryCountry,sell:l.sell}):await G.patch("/tickets/"+c.value,{name:l.name,date:l.date,performer:l.performer,venue:l.venue,area:l.area,row:l.row,seat:l.seat,originalPrice:l.originalPrice,price:l.price,description:l.description,categoryCountry:l.categoryCountry,sell:l.sell}),_({text:c.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),S(),E()}catch(x){console.log(x);const f=((t=(r=x==null?void 0:x.response)==null?void 0:r.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";_({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),g=m(10),n=m([{key:"createdAt",order:"desc"}]),i=m(1),u=m([]),y=[{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"演出日期",align:"center",sortable:!0,key:"date"},{title:"表演者",align:"center",sortable:!0,key:"performer"},{title:"場館",align:"center",sortable:!0,key:"venue"},{title:"區域",align:"center",sortable:!0,key:"area"},{title:"排",align:"center",sortable:!0,key:"row"},{title:"座位",align:"center",sortable:!0,key:"seat"},{title:"原價",align:"center",sortable:!0,key:"originalPrice"},{title:"售價",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"categoryCountry"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],B=m(!0),z=m(0),I=m("");new Date().toISOString().split("T")[0];const b=async()=>{var l,r,t,x;B.value=!0;try{const{data:f}=await G.get("/tickets/my",{params:{page:i.value,itemsPerPage:g.value,sortBy:((l=n.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((r=n.value[0])==null?void 0:r.order)==="asc"?1:-1,search:I.value}});console.log(f.result.data),u.value.splice(0,u.value.length,...f.result.data),z.value=f.result.total}catch(f){console.log(f);const Y=((x=(t=f==null?void 0:f.response)==null?void 0:t.data)==null?void 0:x.message)||"發生錯誤，請稍後再試";_({text:Y,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}B.value=!1};b();const E=()=>{i.value=1,b()};return(l,r)=>(ue(),qe(W,null,[e(re,{class:"pa-0 ma-0"},{default:s(()=>[e(d,{cols:"12",class:"pa-8"},{default:s(()=>[ua,e(aa)]),_:1}),e(ie,{class:"mx-auto",width:"80%"},{default:s(()=>[e(ta,null,{default:s(()=>[e(ce,{value:"MyTickets"},{activator:s(({props:t})=>[e(oe,K(t,{title:"我的票券"}),null,16)]),default:s(()=>[e(oe,null,{default:s(()=>[e(re,{class:"pt-2"},{default:s(()=>[e(d,{cols:"6"},{default:s(()=>[e(J,{color:"green",onClick:r[0]||(r[0]=t=>v())},{default:s(()=>[Q("新增票券")]),_:1})]),_:1}),e(d,{cols:"6"},{default:s(()=>[e(h,{label:"搜尋","append-icon":"mdi-magnify",density:"comfortable",modelValue:I.value,"onUpdate:modelValue":r[1]||(r[1]=t=>I.value=t),rounded:"",variant:"outlined","onClick:append":E,onKeydown:He(E,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(la,{"items-per-page":g.value,"onUpdate:itemsPerPage":[r[2]||(r[2]=t=>g.value=t),b],"sort-by":n.value,"onUpdate:sortBy":[r[3]||(r[3]=t=>n.value=t),b],page:i.value,"onUpdate:page":[r[4]||(r[4]=t=>i.value=t),b],items:u.value,headers:y,loading:B.value,"items-length":z.value,search:I.value,hover:""},{"item.sell":s(({item:t})=>[t.sell?(ue(),ze(Ze,{key:0,icon:"mdi-check"})):Ee("",!0)]),"item.edit":s(({item:t})=>[e(J,{icon:"mdi-pencil",variant:"text",color:"grey",onClick:x=>v(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ce,{value:"Admin"},{activator:s(({props:t})=>[e(oe,K(t,{title:"轉讓紀錄"}),null,16)]),_:1})]),_:1})]),_:1})]),_:1}),e(Ne,{modelValue:A.value,"onUpdate:modelValue":r[17]||(r[17]=t=>A.value=t),width:"500px"},{default:s(()=>[e(ra,{disabled:o(L),onSubmit:Ge(o(U),["prevent"])},{default:s(()=>[e(ie,null,{default:s(()=>[e(Le,null,{default:s(()=>[Q(Oe(c.value===""?"新增票券":"編輯票券"),1)]),_:1}),e(Ke,null,{default:s(()=>[e(re,{"no-gutters":""},{default:s(()=>[e(d,{cols:"12"},{default:s(()=>[e(h,{label:"演唱會名稱",modelValue:o(w).value.value,"onUpdate:modelValue":r[5]||(r[5]=t=>o(w).value.value=t),"error-messages":o(w).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"}),e(d,{cols:"12"},{default:s(()=>[e(h,{label:"演唱會日期",type:"date",modelValue:o(D).value.value,"onUpdate:modelValue":r[6]||(r[6]=t=>o(D).value.value=t),"error-messages":o(D).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(h,{label:"表演者",modelValue:o(C).value.value,"onUpdate:modelValue":r[7]||(r[7]=t=>o(C).value.value=t),"error-messages":o(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(h,{label:"場館",modelValue:o(R).value.value,"onUpdate:modelValue":r[8]||(r[8]=t=>o(R).value.value=t),"error-messages":o(R).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(h,{label:"區域",modelValue:o(F).value.value,"onUpdate:modelValue":r[9]||(r[9]=t=>o(F).value.value=t),"error-messages":o(F).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"6",class:"pr-2"},{default:s(()=>[e(h,{label:"排",modelValue:o(q).value.value,"onUpdate:modelValue":r[10]||(r[10]=t=>o(q).value.value=t),"error-messages":o(q).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"6",class:"pl-2"},{default:s(()=>[e(me,{label:"座位 (非必選)",items:ee,modelValue:o(N).value.value,"onUpdate:modelValue":r[11]||(r[11]=t=>o(N).value.value=t),"error-messages":o(N).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(h,{label:"原始票價",type:"number",min:"0",modelValue:o($).value.value,"onUpdate:modelValue":r[12]||(r[12]=t=>o($).value.value=t),"error-messages":o($).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(h,{label:"售價",type:"number",min:"0",modelValue:o(H).value.value,"onUpdate:modelValue":r[13]||(r[13]=t=>o(H).value.value=t),"error-messages":o(H).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(me,{label:"表演者國籍",items:j,modelValue:o(k).value.value,"onUpdate:modelValue":r[14]||(r[14]=t=>o(k).value.value=t),"error-messages":o(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:s(()=>[e(na,{label:"其他說明",modelValue:o(V).value.value,"onUpdate:modelValue":r[15]||(r[15]=t=>o(V).value.value=t),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(oa,{label:"是否上架",modelValue:o(M).value.value,"onUpdate:modelValue":r[16]||(r[16]=t=>o(M).value.value=t),"error-messages":o(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(je,null,{default:s(()=>[e(Xe),e(J,{color:"red",disabled:o(L),onClick:S},{default:s(()=>[Q("取消")]),_:1},8,["disabled"]),e(J,{color:"green",type:"submit",loading:o(L)},{default:s(()=>[Q("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{wa as default};
