import{p as me,al as ve,D as ke,g as fe,K as ge,am as pe,an as we,l as j,u as ye,ao as Ve,ap as Q,c as a,a as D,aq as Pe,ar as he,r as v,s as Fe,as as Se,ae as Be,w as O,at as Ue,au as Ie,av as Ge,F as J,o as oe,q as Me,aw as Ae,ax as Te,G as Re,C as ee,ay as De,B as $e,az as Ne,T as _e,X as re,$ as qe,Z as n,a8 as He,ab as ze,_ as se,V as X,a1 as Y,af as z,aA as Ee,Y as Le,a6 as Oe,a4 as r,ai as Ke,a3 as je,aa as Xe,aB as Ye,a0 as Ze,a2 as Je,a9 as Qe,a5 as We}from"./index-bdfde2f5.js";import{c as ea,a as K,e as aa,f as ne,g as ta,u as la,b as F,V as oa}from"./index.esm-3b2a05c8.js";import{V as ue,a as Z}from"./VRow-3d316737.js";import{c as ra,V as sa,d as ie,a as ae}from"./VList-ce16dd71.js";import{m as na,V as de,a as ua,b as ce}from"./VDataTableServer-4fb0d3d0.js";import"./VSlideGroup-8b3be92f.js";const ia=me({...ve(),...ke(na(),["inline"])},"VCheckbox"),da=fe()({name:"VCheckbox",inheritAttrs:!1,props:ia(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,A){let{attrs:h,slots:C}=A;const u=ge(e,"modelValue"),{isFocused:d,focus:k,blur:$}=pe(e),N=we(),E=j(()=>e.id||`checkbox-${N}`);return ye(()=>{const[L,T]=Ve(h),_=Q.filterProps(e),p=de.filterProps(e);return a(Q,D({class:["v-checkbox",e.class]},L,_,{modelValue:u.value,"onUpdate:modelValue":y=>u.value=y,id:E.value,focused:d.value,style:e.style}),{...C,default:y=>{let{id:V,messagesId:S,isDisabled:w,isReadonly:B}=y;return a(de,D(p,{id:V.value,"aria-describedby":S.value,disabled:w.value,readonly:B.value},T,{modelValue:u.value,"onUpdate:modelValue":U=>u.value=U,onFocus:k,onBlur:$}),C)}})}),{}}});const ca=me({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ve(),...Pe()},"VTextarea"),ma=fe()({name:"VTextarea",directives:{Intersect:he},inheritAttrs:!1,props:ca(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,A){let{attrs:h,emit:C,slots:u}=A;const d=ge(e,"modelValue"),{isFocused:k,focus:$,blur:N}=pe(e),E=j(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),L=j(()=>{if(h.maxlength)return h.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function T(s,c){var i,m;!e.autofocus||!s||(m=(i=c[0].target)==null?void 0:i.focus)==null||m.call(i)}const _=v(),p=v(),y=Fe(""),V=v(),S=j(()=>e.persistentPlaceholder||k.value||e.active);function w(){var s;V.value!==document.activeElement&&((s=V.value)==null||s.focus()),k.value||$()}function B(s){w(),C("click:control",s)}function U(s){C("mousedown:control",s)}function q(s){s.stopPropagation(),w(),ee(()=>{d.value="",De(e["onClick:clear"],s)})}function H(s){var i;const c=s.target;if(d.value=c.value,(i=e.modelModifiers)!=null&&i.trim){const m=[c.selectionStart,c.selectionEnd];ee(()=>{c.selectionStart=m[0],c.selectionEnd=m[1]})}}const I=v(),G=v(+e.rows),M=j(()=>["plain","underlined"].includes(e.variant));Se(()=>{e.autoGrow||(G.value=+e.rows)});function b(){e.autoGrow&&ee(()=>{if(!I.value||!p.value)return;const s=getComputedStyle(I.value),c=getComputedStyle(p.value.$el),i=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),m=I.value.scrollHeight,P=parseFloat(s.lineHeight),R=Math.max(parseFloat(e.rows)*P+i,parseFloat(c.getPropertyValue("--v-input-control-height"))),o=parseFloat(e.maxRows)*P+i||1/0,l=Ne(m??0,R,o);G.value=Math.floor((l-i)/P),y.value=$e(l)})}Be(b),O(d,b),O(()=>e.rows,b),O(()=>e.maxRows,b),O(()=>e.density,b);let f;return O(I,s=>{s?(f=new ResizeObserver(b),f.observe(I.value)):f==null||f.disconnect()}),Ue(()=>{f==null||f.disconnect()}),ye(()=>{const s=!!(u.counter||e.counter||e.counterValue),c=!!(s||u.details),[i,m]=Ve(h),{modelValue:P,...R}=Q.filterProps(e),o=Ie(e);return a(Q,D({ref:_,modelValue:d.value,"onUpdate:modelValue":l=>d.value=l,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":M.value},e.class],style:e.style},i,R,{centerAffix:G.value===1&&!M.value,focused:k.value}),{...u,default:l=>{let{id:t,isDisabled:x,isDirty:g,isReadonly:W,isValid:be}=l;return a(Ge,D({ref:p,style:{"--v-textarea-control-height":y.value},onClick:B,onMousedown:U,"onClick:clear":q,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},o,{id:t.value,active:S.value||g.value,centerAffix:G.value===1&&!M.value,dirty:g.value||e.dirty,disabled:x.value,focused:k.value,error:be.value===!1}),{...u,default:xe=>{let{props:{class:te,...le}}=xe;return a(J,null,[e.prefix&&a("span",{class:"v-text-field__prefix"},[e.prefix]),oe(a("textarea",D({ref:V,class:te,value:d.value,onInput:H,autofocus:e.autofocus,readonly:W.value,disabled:x.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:w,onBlur:N},le,m),null),[[Me("intersect"),{handler:T},null,{once:!0}]]),e.autoGrow&&oe(a("textarea",{class:[te,"v-textarea__sizer"],id:`${le.id}-sizer`,"onUpdate:modelValue":Ce=>d.value=Ce,ref:I,readonly:!0,"aria-hidden":"true"},null),[[Ae,d.value]]),e.suffix&&a("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:c?l=>{var t;return a(J,null,[(t=u.details)==null?void 0:t.call(u,l),s&&a(J,null,[a("span",null,null),a(Te,{active:e.persistentCounter||k.value,value:E.value,max:L.value},u.counter)])])}:void 0})}),Re({},_,p,V)}}),va=Qe("h1",null,"票券管理",-1),xa={__name:"TicketsView",setup(e){const{apiAuth:A}=ze(),h=_e(),C=v(!1),u=v(""),d=o=>{o?(u.value=o._id,p.value.value=o.name,y.value.value=o.date,V.value.value=o.performer,S.value.value=o.originalPrice,w.value.value=o.price,U.value.value=o.categoryCountry,q.value.value=o.categoryGroup,H.value.value=o.sell,B.value.value=o.description):u.value="",C.value=!0},k=()=>{C.value=!1,_()},$=["台灣","韓國","日本","歐美","泰國","其他"],N=["團體","個人"],E=ea({name:K().required("缺少演唱會名稱"),date:aa().required("缺少演唱會日期").min(new Date,"日期須大於今天"),performer:K().required("缺少表演者名稱"),originalPrice:ne().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:ne().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:K(),categoryCountry:K().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",o=>$.includes(o)),categoryGroup:K().required("請選擇表演者性質").test("isCategoryGroup","表演者性質有誤",o=>N.includes(o)),sell:ta()}),{handleSubmit:L,isSubmitting:T,resetForm:_}=la({validationSchema:E,initialValues:{name:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!1}}),p=F("name"),y=F("date"),V=F("performer"),S=F("originalPrice"),w=F("price"),B=F("description"),U=F("categoryCountry"),q=F("categoryGroup"),H=F("sell"),I=L(async o=>{var l,t;try{u.value===""?await A.post("/tickets",{name:o.name,date:o.date,performer:o.performer,originalPrice:o.originalPrice,price:o.price,description:o.description,categoryCountry:o.categoryCountry,categoryGroup:o.categoryGroup,sell:o.sell}):await A.patch("/tickets/"+u.value,{name:o.name,date:o.date,performer:o.performer,originalPrice:o.originalPrice,price:o.price,description:o.description,categoryCountry:o.categoryCountry,categoryGroup:o.categoryGroup,sell:o.sell}),h({text:u.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),k(),R()}catch(x){console.log(x);const g=((t=(l=x==null?void 0:x.response)==null?void 0:l.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";h({text:g,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),G=v(10),M=v([{key:"createdAt",order:"desc"}]),b=v(1),f=v([]),s=[{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"日期",align:"center",sortable:!0,key:"date"},{title:"表演者",align:"center",sortable:!0,key:"performer"},{title:"原價",align:"center",sortable:!0,key:"originalPrice"},{title:"售價",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"categoryCountry"},{title:"性質",align:"center",sortable:!0,key:"categoryGroup"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],c=v(!0),i=v(0),m=v(""),P=async()=>{var o,l,t,x;c.value=!0;try{const{data:g}=await A.get("/tickets/my",{params:{page:b.value,itemsPerPage:G.value,sortBy:((o=M.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((l=M.value[0])==null?void 0:l.order)==="asc"?1:-1,search:m.value}});f.value.splice(0,f.value.length,...g.result.data),i.value=g.result.total}catch(g){console.log(g);const W=((x=(t=g==null?void 0:g.response)==null?void 0:t.data)==null?void 0:x.message)||"發生錯誤，請稍後再試";h({text:W,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}c.value=!1};P();const R=()=>{b.value=1,P()};return(o,l)=>(re(),qe(J,null,[a(ue,{class:"pa-0 ma-0"},{default:n(()=>[a(Z,{cols:"12",class:"pa-8"},{default:n(()=>[va,a(ra)]),_:1}),a(se,{class:"mx-auto",width:"80%"},{default:n(()=>[a(sa,null,{default:n(()=>[a(ie,{value:"MyTickets"},{activator:n(({props:t})=>[a(ae,D(t,{title:"我的票券"}),null,16)]),default:n(()=>[a(ae,null,{default:n(()=>[a(ue,{class:"pt-2"},{default:n(()=>[a(Z,{cols:"6"},{default:n(()=>[a(X,{color:"green",onClick:l[0]||(l[0]=t=>d())},{default:n(()=>[Y("新增票券")]),_:1})]),_:1}),a(Z,{cols:"6"},{default:n(()=>[a(z,{label:"搜尋","append-icon":"mdi-magnify",density:"comfortable",modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=t=>m.value=t),rounded:"",variant:"outlined","onClick:append":R,onKeydown:Ee(R,["enter"])},null,8,["modelValue"])]),_:1}),a(Z,{cols:"12"},{default:n(()=>[a(ua,{"items-per-page":G.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=t=>G.value=t),P],"sort-by":M.value,"onUpdate:sortBy":[l[3]||(l[3]=t=>M.value=t),P],page:b.value,"onUpdate:page":[l[4]||(l[4]=t=>b.value=t),P],items:f.value,headers:s,loading:c.value,"items-length":i.value,search:m.value,hover:""},{"item.sell":n(({item:t})=>[t.sell?(re(),Le(We,{key:0,icon:"mdi-check"})):Oe("",!0)]),"item.edit":n(({item:t})=>[a(X,{icon:"mdi-pencil",variant:"text",color:"grey",onClick:x=>d(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1})]),_:1}),a(ie,{value:"Admin"},{activator:n(({props:t})=>[a(ae,D(t,{title:"轉讓紀錄"}),null,16)]),_:1})]),_:1})]),_:1})]),_:1}),a(He,{modelValue:C.value,"onUpdate:modelValue":l[14]||(l[14]=t=>C.value=t),width:"500px"},{default:n(()=>[a(oa,{disabled:r(T),onSubmit:Ke(r(I),["prevent"])},{default:n(()=>[a(se,null,{default:n(()=>[a(je,null,{default:n(()=>[Y(Xe(u.value===""?"新增票券":"編輯票券"),1)]),_:1}),a(Ye,null,{default:n(()=>[a(z,{label:"演唱會名稱",modelValue:r(p).value.value,"onUpdate:modelValue":l[5]||(l[5]=t=>r(p).value.value=t),"error-messages":r(p).errorMessage.value},null,8,["modelValue","error-messages"]),a(z,{label:"演唱會日期",type:"date",modelValue:r(y).value.value,"onUpdate:modelValue":l[6]||(l[6]=t=>r(y).value.value=t),"error-messages":r(y).errorMessage.value},null,8,["modelValue","error-messages"]),a(z,{label:"表演者",modelValue:r(V).value.value,"onUpdate:modelValue":l[7]||(l[7]=t=>r(V).value.value=t),"error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"]),a(z,{label:"原始票價",type:"number",min:"0",modelValue:r(S).value.value,"onUpdate:modelValue":l[8]||(l[8]=t=>r(S).value.value=t),"error-messages":r(S).errorMessage.value},null,8,["modelValue","error-messages"]),a(z,{label:"售價",type:"number",min:"0",modelValue:r(w).value.value,"onUpdate:modelValue":l[9]||(l[9]=t=>r(w).value.value=t),"error-messages":r(w).errorMessage.value},null,8,["modelValue","error-messages"]),a(ce,{label:"表演者國籍",items:$,modelValue:r(U).value.value,"onUpdate:modelValue":l[10]||(l[10]=t=>r(U).value.value=t),"error-messages":r(U).errorMessage.value},null,8,["modelValue","error-messages"]),a(ce,{label:"表演者性質",items:N,modelValue:r(q).value.value,"onUpdate:modelValue":l[11]||(l[11]=t=>r(q).value.value=t),"error-messages":r(q).errorMessage.value},null,8,["modelValue","error-messages"]),a(da,{label:"是否上架",modelValue:r(H).value.value,"onUpdate:modelValue":l[12]||(l[12]=t=>r(H).value.value=t),"error-messages":r(H).errorMessage.value},null,8,["modelValue","error-messages"]),a(ma,{label:"其他說明",modelValue:r(B).value.value,"onUpdate:modelValue":l[13]||(l[13]=t=>r(B).value.value=t),"error-messages":r(B).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(Ze,null,{default:n(()=>[a(Je),a(X,{color:"red",disabled:r(T),onClick:k},{default:n(()=>[Y("取消")]),_:1},8,["disabled"]),a(X,{color:"green",type:"submit",loading:r(T)},{default:n(()=>[Y("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{xa as default};
