import{al as q,S as v,T as $,R as T,r as D,ae as I,W as N,X as R,Y as A,Z as o,ab as E,c as t,a9 as l,aa as n,a4 as p,ai as L,_ as M,am as W,af as m,a0 as j,a2 as U,V as b,a1 as h}from"./index-c58a86af.js";import{c as X,a as d,d as Y,e as V,f as Z,V as z}from"./index.esm-ad1d64b1.js";import{u as H,a as i}from"./vee-validate.esm-4345f00f.js";import{a as f,V as J}from"./VList-7fc3710a.js";import{V as K,a as u}from"./VRow-965a2736.js";import{V as _}from"./VDivider-841cc530.js";import{V as O}from"./VSelect-84b54b46.js";import{V as Q}from"./VCheckbox-ed46cde0.js";import"./VSlideGroup-bdc5eb0c.js";const ee={style:{color:"#e76813"}},te={style:{"font-weight":"700",color:"#e76813"}},re=l("h2",{style:{"margin-top":"30px"}},"聯絡資訊",-1),ge={__name:"PayView",setup(ae){const k=q(),P=v(),{api:w,apiAuth:C}=E(),g=$();T();const x=["信用卡","轉帳","linepay"],a=D({_id:"",name:"",date:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!0});I(async()=>{var e,s;try{const{data:r}=await w.get("/tickets/"+k.params.id);a.value._id=r.result._id,a.value.name=r.result.name,a.value.date=r.result.date,a.value.performer=r.result.performer,a.value.originalPrice=r.result.originalPrice,a.value.price=r.result.price,a.value.description=r.result.description,a.value.categoryCountry=r.result.categoryCountry,a.value.categoryGroup=r.result.categoryGroup,a.value.sell=r.result.sell,document.title=`GoConcert - ${a.value.name}`}catch(r){const c=((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";g({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),P.push("/")}});const G=X({name:d().required("缺少演唱會名稱"),date:Y().required("缺少演唱會日期").min(new Date,"日期須大於今天"),performer:d().required("缺少表演者名稱"),originalPrice:V().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:V().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:d(),categoryCountry:d().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",e=>CategoryCountry.includes(e)),categoryGroup:d().required("請選擇表演者性質").test("isCategoryGroup","表演者性質有誤",e=>CategoryGroup.includes(e)),sell:Z()}),{handleSubmit:S,isSubmitting:y,resetForm:oe}=H({validationSchema:G,initialValues:{name:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!1}});i("name"),i("date"),i("performer"),i("originalPrice"),i("price"),i("description"),i("categoryCountry"),i("categoryGroup"),i("sell");const B=S(async e=>{var s,r;try{dialogId.value===""?await C.post("/tickets",{name:e.name,date:e.date,performer:e.performer,originalPrice:e.originalPrice,price:e.price,description:e.description,categoryCountry:e.categoryCountry,categoryGroup:e.categoryGroup,sell:e.sell}):await C.patch("/tickets/"+dialogId.value,{name:e.name,date:e.date,performer:e.performer,originalPrice:e.originalPrice,price:e.price,description:e.description,categoryCountry:e.categoryCountry,categoryGroup:e.categoryGroup,sell:e.sell}),g({text:dialogId.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(c){console.log(c);const F=((r=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";g({text:F,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(e,s)=>{const r=N("container");return R(),A(r,{style:{"align-items":"center",width:"90%","justify-content":"center",display:"flex","margin-top":"30px"}},{default:o(()=>[t(J,{style:{width:"800px","background-color":"rgba(256, 256, 256, 0.8)"}},{default:o(()=>[t(f,null,{default:o(()=>[t(K,null,{default:o(()=>[t(u,{cols:"12"},{default:o(()=>[l("h1",ee,n(a.value.name),1)]),_:1}),t(_),t(u,{cols:"6"},{default:o(()=>[l("h3",null,"表演者："+n(a.value.performer),1)]),_:1}),t(u,{cols:"6"},{default:o(()=>[l("h3",null,"原價："+n(a.value.originalPrice),1)]),_:1}),t(u,{cols:"12"},{default:o(()=>[l("h3",null,"演出日期："+n(a.value.date),1)]),_:1}),t(u,{cols:"12"},{default:o(()=>[l("h3",null,"其他說明："+n(a.value.description),1)]),_:1}),t(_),t(u,{cols:"12"},{default:o(()=>[l("h2",te,"售價：NT$ "+n(a.value.price),1)]),_:1})]),_:1})]),_:1}),t(_),t(f,{style:{"background-color":"#FFFBE6"}}),t(f,null,{default:o(()=>[t(z,{disabled:p(y),onSubmit:L(p(B),["prevent"])},{default:o(()=>[t(M,null,{default:o(()=>[re,t(W,null,{default:o(()=>[t(m,{label:"收件人姓名"}),t(m,{label:"連絡電話"}),t(m,{label:"電子信箱"}),t(m,{label:"地址"}),t(O,{label:"付款方式",items:x}),t(Q,{label:"我以閱讀並同意服務條款"})]),_:1}),t(j,null,{default:o(()=>[t(U),t(b,{color:"red",disabled:p(y),onClick:e.closeDialog},{default:o(()=>[h("返回")]),_:1},8,["disabled","onClick"]),t(b,{color:"green",type:"submit",loading:p(y)},{default:o(()=>[h("確認送出訂單")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})}}};export{ge as default};
