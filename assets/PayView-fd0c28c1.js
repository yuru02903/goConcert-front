import{al as X,S as Y,T as Z,R as z,r as H,am as J,X as d,Y as p,Z as l,ab as K,c as e,a9 as i,aa as c,$ as _,a4 as r,aj as O,_ as Q,an as ee,af as g,a6 as V,a0 as ae,a2 as le,V as E,a1 as T}from"./index-677308fb.js";import{c as te,a as m,V as A,u as re,b as v}from"./index.esm-48f1a928.js";import{v as se}from"./index-ddb1b719.js";import{V as oe}from"./VContainer-2285781b.js";import{a as M,V as ue}from"./VList-89e46962.js";import{V as W}from"./VRow-4d2e5ac7.js";import{V as u}from"./VCol-1f3ac925.js";import{V as N}from"./VDivider-d8cfd718.js";import{V as ne}from"./VForm-8504ae8a.js";import{V as B}from"./VSelect-7702c734.js";import{V as ie}from"./VCheckbox-12bc21e1.js";import"./VSlideGroup-53381ab9.js";const de={class:"color-textPrimary"},ce={key:0},me={key:1},ve={key:0},pe={key:1},fe={class:"color-textPrimary",style:{"font-weight":"700"}},ye=i("h2",{style:{"margin-top":"30px"}},"收件資訊",-1),ge=i("h4",{class:"px-2 pb-4"},"賣家將透過email與您聯繫面交時間地點，請確認email為可用信箱；待訂單成立後將告知賣家email，請留意郵箱信件，謝謝！",-1),_e=i("h2",null,"抱歉，該票券已售出或下架",-1),Ue={__name:"PayView",setup(Ve){const D=X(),U=Y(),{apiAuth:h}=K(),b=Z();z();const $=["信用卡","轉帳","linepay"],F=["面交","超商取貨","宅配"],R=["7-11","全家"],t=H({_id:"",seller:"",name:"",date:"",performer:"",venue:"",area:"",row:"",seat:"",originalPrice:0,price:0,description:"",categoryCountry:"",sell:!0}),j=te({recipient:m().trim().required("缺少收件人"),recipientPhone:m().required("缺少連絡電話").matches(/^0\d{9}$/,"連絡電話格式有誤"),recipientMail:m().required("缺少聯絡信箱").test("isEmail","信箱格式有誤",s=>se.isEmail(s)),deliveryWay:m().required("請選擇交貨方式").test("isDeliveryWay","交貨方式有誤",s=>F.includes(s)),address:m().trim().test("needAddress","缺少宅配地址",s=>!(n.value.value==="宅配"&&s==="")),convenienceStore:m().test("needChooseConvenienceStore","尚未選擇超商",s=>!(n.value.value==="超商取貨"&&s==="")),convenienceStoreNumber:m().test("needConvenienceStoreNumber","請填寫超商店號",s=>{if(n.value.value==="超商取貨"&&s==="")return!1;if(n.value.value==="超商取貨"&&y.value.value==="7-11"){if(/^[1-9]\d{5}$/.test(s))return!0;throw new A("7-11超商店號為1~9開頭的六位數字，請重新確認所選超商及店號",s,"convenienceStoreNumber")}else if(n.value.value==="超商取貨"&&y.value.value==="全家"){if(/^0\d{5}$/.test(s))return!0;throw new A("全家超商店號為0開頭的六位數字，請重新確認所選超商及店號",s,"convenienceStoreNumber")}else if(n.value.value!=="超商取貨")return!0}),payWay:m().required("請選擇付款方式").test("isPayWay","付款方式有誤",s=>$.includes(s))}),{handleSubmit:L,isSubmitting:q}=re({validationSchema:j,initialValues:{recipient:"",recipientPhone:"",recipientMail:"",deliveryWay:"",address:"",convenienceStore:"",convenienceStoreNumber:"",payWay:""}}),S=v("recipient"),k=v("recipientPhone"),w=v("recipientMail"),n=v("deliveryWay"),x=v("address"),y=v("convenienceStore"),P=v("convenienceStoreNumber"),C=v("payWay"),G=L(async s=>{var o,a;try{await h.post("/orders",{ticket:t.value._id,recipient:s.recipient,recipientPhone:s.recipientPhone,recipientMail:s.recipientMail,deliveryWay:s.deliveryWay,address:s.address,convenienceStore:s.convenienceStore,convenienceStoreNumber:s.convenienceStoreNumber,payWay:s.payWay}),await h.patch("/tickets/"+t.value._id,{sell:!1,orderStatus:"買家已下單"}),b({text:"下單成功，已通知賣家",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),U.push("/tickets")}catch(f){console.log(f);const I=((a=(o=f==null?void 0:f.response)==null?void 0:o.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";b({text:I,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return J(async()=>{var s,o;try{const{data:a}=await h.get("/tickets/"+D.params.id);t.value._id=a.result._id,t.value.name=a.result.name,t.value.date=a.result.date,t.value.performer=a.result.performer,t.value.venue=a.result.venue,t.value.area=a.result.area,t.value.row=a.result.row,t.value.seat=a.result.seat,t.value.originalPrice=a.result.originalPrice,t.value.price=a.result.price,t.value.categoryCountry=a.result.categoryCountry,t.value.description=a.result.description,t.value.sell=a.result.sell,t.value.seller=a.result.seller,document.title=`GoConcert - ${t.value.name}`}catch(a){const f=((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";b({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),U.push("/")}}),(s,o)=>(d(),p(oe,{style:{"align-items":"center",width:"90%","justify-content":"center",display:"flex","padding-top":"30px",margin:"auto"}},{default:l(()=>[e(ue,{style:{width:"800px","background-color":"rgba(256, 256, 256, 0.8)"}},{default:l(()=>[e(M,null,{default:l(()=>[e(W,null,{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[i("h1",de,c(t.value.name),1)]),_:1}),e(N),e(u,{cols:"12"},{default:l(()=>[i("h3",null,"賣家："+c(t.value.seller.account),1)]),_:1}),e(u,{cols:"12",md:"6"},{default:l(()=>[i("h3",null,"表演者："+c(t.value.performer),1)]),_:1}),e(u,{cols:"12",md:"6"},{default:l(()=>[i("h3",null,"演出日期："+c(t.value.date),1)]),_:1}),e(u,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i("h3",null,"場館："+c(t.value.venue),1)]),_:1}),e(u,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i("h3",null,"區域："+c(t.value.area),1)]),_:1}),e(u,{cols:"12",md:"6",lg:"3"},{default:l(()=>[i("h3",null,"排數："+c(t.value.row)+" 排",1)]),_:1}),e(u,{cols:"12",md:"6",lg:"3"},{default:l(()=>[t.value.description.length>0?(d(),_("h3",ce,"座位："+c(t.value.seat),1)):(d(),_("h3",me,"座位：未提供資訊"))]),_:1}),e(u,{cols:"12"},{default:l(()=>[t.value.description.length>0?(d(),_("h3",ve,"其他說明："+c(t.value.description),1)):(d(),_("h3",pe,"其他說明：無"))]),_:1}),e(u,{cols:"12"},{default:l(()=>[i("h3",null,"原價："+c(t.value.originalPrice),1)]),_:1}),e(N),e(u,{cols:"12"},{default:l(()=>[i("h2",fe,"售價：NT$ "+c(t.value.price),1)]),_:1})]),_:1})]),_:1}),e(N),e(M,{style:{"background-color":"#FFFBE6"}}),e(M,null,{default:l(()=>[t.value.sell?(d(),p(ne,{key:0,disabled:r(q),onSubmit:O(r(G),["prevent"])},{default:l(()=>[e(Q,null,{default:l(()=>[ye,e(ee,null,{default:l(()=>[e(W,{"no-gutters":""},{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[e(g,{label:"收件人姓名",modelValue:r(S).value.value,"onUpdate:modelValue":o[0]||(o[0]=a=>r(S).value.value=a),"error-messages":r(S).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12"},{default:l(()=>[e(g,{label:"連絡電話",modelValue:r(k).value.value,"onUpdate:modelValue":o[1]||(o[1]=a=>r(k).value.value=a),"error-messages":r(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12"},{default:l(()=>[e(g,{label:"電子信箱",modelValue:r(w).value.value,"onUpdate:modelValue":o[2]||(o[2]=a=>r(w).value.value=a),"error-messages":r(w).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12"},{default:l(()=>[e(B,{label:"交貨方式",items:F,modelValue:r(n).value.value,"onUpdate:modelValue":o[3]||(o[3]=a=>r(n).value.value=a),"error-messages":r(n).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),r(n).value.value==="面交"?(d(),p(u,{key:0,cols:"12"},{default:l(()=>[ge]),_:1})):V("",!0),r(n).value.value==="宅配"?(d(),p(u,{key:1,cols:"12"},{default:l(()=>[e(g,{label:"宅配地址",modelValue:r(x).value.value,"onUpdate:modelValue":o[4]||(o[4]=a=>r(x).value.value=a),"error-messages":r(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})):V("",!0),r(n).value.value==="超商取貨"?(d(),p(u,{key:2,cols:"12",md:"5"},{default:l(()=>[e(B,{label:"請選擇超商",items:R,modelValue:r(y).value.value,"onUpdate:modelValue":o[5]||(o[5]=a=>r(y).value.value=a),"error-messages":r(y).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})):V("",!0),r(n).value.value==="超商取貨"?(d(),p(u,{key:3,cols:"12",md:"6","offset-md":"1"},{default:l(()=>[e(g,{label:"店號",modelValue:r(P).value.value,"onUpdate:modelValue":o[6]||(o[6]=a=>r(P).value.value=a),"error-messages":r(P).errorMessage.value,maxlength:"6",counter:""},null,8,["modelValue","error-messages"])]),_:1})):V("",!0),e(u,{cols:"12"},{default:l(()=>[e(B,{label:"付款方式",items:$,modelValue:r(C).value.value,"onUpdate:modelValue":o[7]||(o[7]=a=>r(C).value.value=a),"error-messages":r(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(u,{cols:"12"},{default:l(()=>[e(ie,{label:"我已閱讀並同意服務條款"})]),_:1})]),_:1})]),_:1}),e(ae,null,{default:l(()=>[e(le),e(E,{color:"green",type:"submit",loading:r(q)},{default:l(()=>[T("送出訂單")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])):(d(),p(W,{key:1,style:{"text-align":"center","align-items":"center"},class:"py-4"},{default:l(()=>[e(u,{cols:"12"},{default:l(()=>[_e]),_:1}),e(u,{cols:"12"},{default:l(()=>[e(E,{color:"textPrimary",to:"/tickets"},{default:l(()=>[T("返回")]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}))}};export{Ue as default};
