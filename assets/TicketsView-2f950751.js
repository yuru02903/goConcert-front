import{p as de,ah as me,D as ke,g as ve,K as fe,ai as ge,aj as he,l as O,u as pe,ak as ye,al as J,c as t,a as R,am as we,an as Pe,r as v,s as Fe,ao as Se,ap as Be,w as E,aq as Ie,ar as Ue,as as Ge,F as Z,o as le,q as Me,at as Ae,au as Te,G as Re,C as W,av as De,B as _e,aw as $e,T as Ne,X as oe,$ as He,Z as n,a8 as qe,ab as Ee,_ as re,V as j,a1 as X,ad as z,ax as ze,Y as Le,a6 as Oe,a4 as r,ae as Ke,a3 as je,aa as Xe,ay as Ye,a0 as Ze,a2 as Je,a9 as Qe,a5 as We}from"./index-472d0ee0.js";import{c as ea,a as L,e as se,f as aa,u as ta,b as M,V as la}from"./index.esm-e214c10f.js";import{V as ne,a as Y}from"./VRow-88b978d7.js";import{c as oa,V as ra,d as ue,a as ee}from"./VList-54ec541c.js";import{m as sa,V as ie,a as na,b as ce}from"./VDataTableServer-832218e4.js";import"./VSlideGroup-e588eb32.js";const ua=de({...me(),...ke(sa(),["inline"])},"VCheckbox"),ia=ve()({name:"VCheckbox",inheritAttrs:!1,props:ua(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,A){let{attrs:P,slots:b}=A;const u=fe(e,"modelValue"),{isFocused:c,focus:x,blur:D}=ge(e),_=he(),H=O(()=>e.id||`checkbox-${_}`);return pe(()=>{const[q,T]=ye(P),$=J.filterProps(e),p=ie.filterProps(e);return t(J,R({class:["v-checkbox",e.class]},q,$,{modelValue:u.value,"onUpdate:modelValue":y=>u.value=y,id:H.value,focused:c.value,style:e.style}),{...b,default:y=>{let{id:V,messagesId:S,isDisabled:C,isReadonly:B}=y;return t(ie,R(p,{id:V.value,"aria-describedby":S.value,disabled:C.value,readonly:B.value},T,{modelValue:u.value,"onUpdate:modelValue":I=>u.value=I,onFocus:x,onBlur:D}),b)}})}),{}}});const ca=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...me(),...we()},"VTextarea"),da=ve()({name:"VTextarea",directives:{Intersect:Pe},inheritAttrs:!1,props:ca(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,A){let{attrs:P,emit:b,slots:u}=A;const c=fe(e,"modelValue"),{isFocused:x,focus:D,blur:_}=ge(e),H=O(()=>typeof e.counterValue=="function"?e.counterValue(c.value):(c.value||"").toString().length),q=O(()=>{if(P.maxlength)return P.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function T(s,m){var i,d;!e.autofocus||!s||(d=(i=m[0].target)==null?void 0:i.focus)==null||d.call(i)}const $=v(),p=v(),y=Fe(""),V=v(),S=O(()=>e.persistentPlaceholder||x.value||e.active);function C(){var s;V.value!==document.activeElement&&((s=V.value)==null||s.focus()),x.value||D()}function B(s){C(),b("click:control",s)}function I(s){b("mousedown:control",s)}function N(s){s.stopPropagation(),C(),W(()=>{c.value="",De(e["onClick:clear"],s)})}function Q(s){var i;const m=s.target;if(c.value=m.value,(i=e.modelModifiers)!=null&&i.trim){const d=[m.selectionStart,m.selectionEnd];W(()=>{m.selectionStart=d[0],m.selectionEnd=d[1]})}}const k=v(),F=v(+e.rows),U=O(()=>["plain","underlined"].includes(e.variant));Se(()=>{e.autoGrow||(F.value=+e.rows)});function h(){e.autoGrow&&W(()=>{if(!k.value||!p.value)return;const s=getComputedStyle(k.value),m=getComputedStyle(p.value.$el),i=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),d=k.value.scrollHeight,G=parseFloat(s.lineHeight),l=Math.max(parseFloat(e.rows)*G+i,parseFloat(m.getPropertyValue("--v-input-control-height"))),o=parseFloat(e.maxRows)*G+i||1/0,a=$e(d??0,l,o);F.value=Math.floor((a-i)/G),y.value=_e(a)})}Be(h),E(c,h),E(()=>e.rows,h),E(()=>e.maxRows,h),E(()=>e.density,h);let w;return E(k,s=>{s?(w=new ResizeObserver(h),w.observe(k.value)):w==null||w.disconnect()}),Ie(()=>{w==null||w.disconnect()}),pe(()=>{const s=!!(u.counter||e.counter||e.counterValue),m=!!(s||u.details),[i,d]=ye(P),{modelValue:G,...l}=J.filterProps(e),o=Ue(e);return t(J,R({ref:$,modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":U.value},e.class],style:e.style},i,l,{centerAffix:F.value===1&&!U.value,focused:x.value}),{...u,default:a=>{let{id:f,isDisabled:g,isDirty:K,isReadonly:Ve,isValid:be}=a;return t(Ge,R({ref:p,style:{"--v-textarea-control-height":y.value},onClick:B,onMousedown:I,"onClick:clear":N,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},o,{id:f.value,active:S.value||K.value,centerAffix:F.value===1&&!U.value,dirty:K.value||e.dirty,disabled:g.value,focused:x.value,error:be.value===!1}),{...u,default:xe=>{let{props:{class:ae,...te}}=xe;return t(Z,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),le(t("textarea",R({ref:V,class:ae,value:c.value,onInput:Q,autofocus:e.autofocus,readonly:Ve.value,disabled:g.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:C,onBlur:_},te,d),null),[[Me("intersect"),{handler:T},null,{once:!0}]]),e.autoGrow&&le(t("textarea",{class:[ae,"v-textarea__sizer"],id:`${te.id}-sizer`,"onUpdate:modelValue":Ce=>c.value=Ce,ref:k,readonly:!0,"aria-hidden":"true"},null),[[Ae,c.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:m?a=>{var f;return t(Z,null,[(f=u.details)==null?void 0:f.call(u,a),s&&t(Z,null,[t("span",null,null),t(Te,{active:e.persistentCounter||x.value,value:H.value,max:q.value},u.counter)])])}:void 0})}),Re({},$,p,V)}}),ma=Qe("h1",null,"票券管理",-1),ba={__name:"TicketsView",setup(e){const{apiAuth:A}=Ee(),P=Ne(),b=v(!1),u=v(""),c=l=>{l?(u.value=l._id,p.value.value=l.name,y.value.value=l.performer,V.value.value=l.originalPrice,S.value.value=l.price,B.value.value=l.categoryCountry,I.value.value=l.categoryGroup,N.value.value=l.sell,C.value.value=l.description):u.value="",b.value=!0},x=()=>{b.value=!1,$()},D=["台灣","韓國","日本","歐美","泰國","其他"],_=["團體","個人"],H=ea({name:L().required("缺少演唱會名稱"),performer:L().required("缺少表演者名稱"),originalPrice:se().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:se().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:L(),categoryCountry:L().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",l=>D.includes(l)),categoryGroup:L().required("請選擇表演者性質").test("isCategoryGroup","表演者性質有誤",l=>_.includes(l)),sell:aa()}),{handleSubmit:q,isSubmitting:T,resetForm:$}=ta({validationSchema:H,initialValues:{name:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!1}}),p=M("name"),y=M("performer"),V=M("originalPrice"),S=M("price"),C=M("description"),B=M("categoryCountry"),I=M("categoryGroup"),N=M("sell"),Q=q(async l=>{var o,a;try{u.value===""?await A.post("/tickets",{name:l.name,performer:l.performer,originalPrice:l.originalPrice,price:l.price,description:l.description,categoryCountry:l.categoryCountry,categoryGroup:l.categoryGroup,sell:l.sell}):await A.patch("/tickets/"+u.value,{name:l.name,performer:l.performer,originalPrice:l.originalPrice,price:l.price,description:l.description,categoryCountry:l.categoryCountry,categoryGroup:l.categoryGroup,sell:l.sell}),P({text:u.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),x(),G()}catch(f){console.log(f);const g=((a=(o=f==null?void 0:f.response)==null?void 0:o.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";P({text:g,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),k=v(10),F=v([{key:"createdAt",order:"desc"}]),U=v(1),h=v([]),w=[{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"表演者",align:"center",sortable:!0,key:"performer"},{title:"原價",align:"center",sortable:!0,key:"originalPrice"},{title:"售價",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"categoryCountry"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],s=v(!0),m=v(0),i=v(""),d=async()=>{var l,o,a,f;s.value=!0;try{const{data:g}=await A.get("/tickets/my",{params:{page:U.value,itemsPerPage:k.value,sortBy:((l=F.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((o=F.value[0])==null?void 0:o.order)==="asc"?1:-1,search:i.value}});h.value.splice(0,h.value.length,...g.result.data),m.value=g.result.total}catch(g){console.log(g);const K=((f=(a=g==null?void 0:g.response)==null?void 0:a.data)==null?void 0:f.message)||"發生錯誤，請稍後再試";P({text:K,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}s.value=!1};d();const G=()=>{U.value=1,d()};return(l,o)=>(oe(),He(Z,null,[t(ne,{class:"pa-0 ma-0"},{default:n(()=>[t(Y,{cols:"12",class:"pa-8"},{default:n(()=>[ma,t(oa)]),_:1}),t(re,{class:"mx-auto",width:"80%"},{default:n(()=>[t(ra,null,{default:n(()=>[t(ue,{value:"MyTickets"},{activator:n(({props:a})=>[t(ee,R(a,{title:"我的票券"}),null,16)]),default:n(()=>[t(ee,null,{default:n(()=>[t(ne,{class:"pt-2"},{default:n(()=>[t(Y,{cols:"6"},{default:n(()=>[t(j,{color:"green",onClick:o[0]||(o[0]=a=>c())},{default:n(()=>[X("新增票券")]),_:1})]),_:1}),t(Y,{cols:"6"},{default:n(()=>[t(z,{label:"搜尋","append-icon":"mdi-magnify",density:"comfortable",modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=a=>i.value=a),rounded:"",variant:"outlined","onClick:append":G,onKeydown:ze(G,["enter"])},null,8,["modelValue"])]),_:1}),t(Y,{cols:"12"},{default:n(()=>[t(na,{"items-per-page":k.value,"onUpdate:itemsPerPage":[o[2]||(o[2]=a=>k.value=a),d],"sort-by":F.value,"onUpdate:sortBy":[o[3]||(o[3]=a=>F.value=a),d],page:U.value,"onUpdate:page":[o[4]||(o[4]=a=>U.value=a),d],items:h.value,headers:w,loading:s.value,"items-length":m.value,search:i.value,hover:""},{"item.sell":n(({item:a})=>[a.sell?(oe(),Le(We,{key:0,icon:"mdi-check"})):Oe("",!0)]),"item.edit":n(({item:a})=>[t(j,{icon:"mdi-pencil",variant:"text",color:"grey",onClick:f=>c(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ue,{value:"Admin"},{activator:n(({props:a})=>[t(ee,R(a,{title:"轉讓紀錄"}),null,16)]),_:1})]),_:1})]),_:1})]),_:1}),t(qe,{modelValue:b.value,"onUpdate:modelValue":o[13]||(o[13]=a=>b.value=a),width:"500px"},{default:n(()=>[t(la,{disabled:r(T),onSubmit:Ke(r(Q),["prevent"])},{default:n(()=>[t(re,null,{default:n(()=>[t(je,null,{default:n(()=>[X(Xe(u.value===""?"新增票券":"編輯票券"),1)]),_:1}),t(Ye,null,{default:n(()=>[t(z,{label:"演唱會名稱",modelValue:r(p).value.value,"onUpdate:modelValue":o[5]||(o[5]=a=>r(p).value.value=a),"error-messages":r(p).errorMessage.value},null,8,["modelValue","error-messages"]),t(z,{label:"表演者",modelValue:r(y).value.value,"onUpdate:modelValue":o[6]||(o[6]=a=>r(y).value.value=a),"error-messages":r(y).errorMessage.value},null,8,["modelValue","error-messages"]),t(z,{label:"原始票價",type:"number",min:"0",modelValue:r(V).value.value,"onUpdate:modelValue":o[7]||(o[7]=a=>r(V).value.value=a),"error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(z,{label:"售價",type:"number",min:"0",modelValue:r(S).value.value,"onUpdate:modelValue":o[8]||(o[8]=a=>r(S).value.value=a),"error-messages":r(S).errorMessage.value},null,8,["modelValue","error-messages"]),t(ce,{label:"表演者國籍",items:D,modelValue:r(B).value.value,"onUpdate:modelValue":o[9]||(o[9]=a=>r(B).value.value=a),"error-messages":r(B).errorMessage.value},null,8,["modelValue","error-messages"]),t(ce,{label:"表演者性質",items:_,modelValue:r(I).value.value,"onUpdate:modelValue":o[10]||(o[10]=a=>r(I).value.value=a),"error-messages":r(I).errorMessage.value},null,8,["modelValue","error-messages"]),t(ia,{label:"是否上架",modelValue:r(N).value.value,"onUpdate:modelValue":o[11]||(o[11]=a=>r(N).value.value=a),"error-messages":r(N).errorMessage.value},null,8,["modelValue","error-messages"]),t(da,{label:"其他說明",modelValue:r(C).value.value,"onUpdate:modelValue":o[12]||(o[12]=a=>r(C).value.value=a),"error-messages":r(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(Ze,null,{default:n(()=>[t(Je),t(j,{color:"red",disabled:r(T),onClick:x},{default:n(()=>[X("取消")]),_:1},8,["disabled"]),t(j,{color:"green",type:"submit",loading:r(T)},{default:n(()=>[X("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{ba as default};
