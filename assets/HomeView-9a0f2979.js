import{p as fe,ao as ge,ap as pe,g as ye,aq as Ve,K as xe,ar as be,l as O,r as m,s as Ce,as as we,af as ke,w as H,at as Pe,u as he,au as Fe,av as le,aw as Se,c as t,ax as Be,a as q,F as Y,o as oe,q as Ge,ay as Ie,az as Me,G as Ue,C as W,aA as Te,B as Ae,aB as Re,T as De,X as re,$ as Ne,Z as s,a8 as $e,ab as He,_ as ne,V as K,a1 as j,ag as D,aC as _e,Y as qe,a6 as ze,a4 as r,aj as Ee,a3 as Le,aa as Oe,an as Ke,a0 as je,a2 as Xe,a9 as Ye,a5 as Ze}from"./index-97a566c0.js";import{c as Je,a as _,d as Qe,e as se,f as We,V as ea}from"./index.esm-fe55acc4.js";import{u as aa,a as C}from"./vee-validate.esm-1de6ed27.js";import{V as ue,a as X}from"./VRow-a212f59e.js";import{V as ta}from"./VDivider-d6fa2005.js";import{V as la,c as ie,a as ee}from"./VList-6532eaee.js";import{V as oa}from"./VDataTableServer-edaefb46.js";import{V as de}from"./VSelect-c187855e.js";import{V as ra}from"./VCheckbox-bcfd6ae1.js";import"./VSlideGroup-f98359a3.js";const na=fe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ge(),...pe()},"VTextarea"),sa=ye()({name:"VTextarea",directives:{Intersect:Ve},inheritAttrs:!1,props:na(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,N){let{attrs:S,emit:B,slots:i}=N;const v=xe(e,"modelValue"),{isFocused:w,focus:z,blur:E}=be(e),Z=O(()=>typeof e.counterValue=="function"?e.counterValue(v.value):(v.value||"").toString().length),J=O(()=>{if(S.maxlength)return S.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function $(n,d){var u,c;!e.autofocus||!n||(c=(u=d[0].target)==null?void 0:u.focus)==null||c.call(u)}const L=m(),x=m(),G=Ce(""),b=m(),M=O(()=>e.persistentPlaceholder||w.value||e.active);function k(){var n;b.value!==document.activeElement&&((n=b.value)==null||n.focus()),w.value||z()}function U(n){k(),B("click:control",n)}function T(n){B("mousedown:control",n)}function A(n){n.stopPropagation(),k(),W(()=>{v.value="",Te(e["onClick:clear"],n)})}function R(n){var u;const d=n.target;if(v.value=d.value,(u=e.modelModifiers)!=null&&u.trim){const c=[d.selectionStart,d.selectionEnd];W(()=>{d.selectionStart=c[0],d.selectionEnd=c[1]})}}const P=m(),h=m(+e.rows),F=O(()=>["plain","underlined"].includes(e.variant));we(()=>{e.autoGrow||(h.value=+e.rows)});function p(){e.autoGrow&&W(()=>{if(!P.value||!x.value)return;const n=getComputedStyle(P.value),d=getComputedStyle(x.value.$el),u=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),c=P.value.scrollHeight,V=parseFloat(n.lineHeight),I=Math.max(parseFloat(e.rows)*V+u,parseFloat(d.getPropertyValue("--v-input-control-height"))),o=parseFloat(e.maxRows)*V+u||1/0,l=Re(c??0,I,o);h.value=Math.floor((l-u)/V),G.value=Ae(l)})}ke(p),H(v,p),H(()=>e.rows,p),H(()=>e.maxRows,p),H(()=>e.density,p);let f;return H(P,n=>{n?(f=new ResizeObserver(p),f.observe(P.value)):f==null||f.disconnect()}),Pe(()=>{f==null||f.disconnect()}),he(()=>{const n=!!(i.counter||e.counter||e.counterValue),d=!!(n||i.details),[u,c]=Fe(S),{modelValue:V,...I}=le.filterProps(e),o=Se(e);return t(le,q({ref:L,modelValue:v.value,"onUpdate:modelValue":l=>v.value=l,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":F.value},e.class],style:e.style},u,I,{centerAffix:h.value===1&&!F.value,focused:w.value}),{...i,default:l=>{let{id:a,isDisabled:y,isDirty:g,isReadonly:Q,isValid:ce}=l;return t(Be,q({ref:x,style:{"--v-textarea-control-height":G.value},onClick:U,onMousedown:T,"onClick:clear":A,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},o,{id:a.value,active:M.value||g.value,centerAffix:h.value===1&&!F.value,dirty:g.value||e.dirty,disabled:y.value,focused:w.value,error:ce.value===!1}),{...i,default:me=>{let{props:{class:ae,...te}}=me;return t(Y,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),oe(t("textarea",q({ref:b,class:ae,value:v.value,onInput:R,autofocus:e.autofocus,readonly:Q.value,disabled:y.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:k,onBlur:E},te,c),null),[[Ge("intersect"),{handler:$},null,{once:!0}]]),e.autoGrow&&oe(t("textarea",{class:[ae,"v-textarea__sizer"],id:`${te.id}-sizer`,"onUpdate:modelValue":ve=>v.value=ve,ref:P,readonly:!0,"aria-hidden":"true"},null),[[Ie,v.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:d?l=>{var a;return t(Y,null,[(a=i.details)==null?void 0:a.call(i,l),n&&t(Y,null,[t("span",null,null),t(Me,{active:e.persistentCounter||w.value,value:Z.value,max:J.value},i.counter)])])}:void 0})}),Ue({},L,x,b)}}),ua=Ye("h1",null,"票券管理",-1),xa={__name:"HomeView",setup(e){const{apiAuth:N}=He(),S=De(),B=m(!1),i=m(""),v=o=>{o?(i.value=o._id,x.value.value=o.name,G.value.value=o.date,b.value.value=o.performer,M.value.value=o.originalPrice,k.value.value=o.price,T.value.value=o.categoryCountry,A.value.value=o.categoryGroup,R.value.value=o.sell,U.value.value=o.description):i.value="",B.value=!0},w=()=>{B.value=!1,L()},z=["台灣","韓國","日本","歐美","泰國","其他"],E=["團體","個人"],Z=Je({name:_().required("缺少演唱會名稱"),date:Qe().required("缺少演唱會日期").min(new Date,"日期須大於今天"),performer:_().required("缺少表演者名稱"),originalPrice:se().typeError("票券原價格式錯誤，請填寫數字").required("請填寫票券原價").min(0,"價格不能小於0"),price:se().typeError("票券售價格式錯誤，請填寫數字").required("請填寫票券售價").min(0,"價格不能小於0"),description:_(),categoryCountry:_().required("請選擇表演者國籍").test("isCategoryCountry","表演者國籍有誤",o=>z.includes(o)),categoryGroup:_().required("請選擇表演者性質").test("isCategoryGroup","表演者性質有誤",o=>E.includes(o)),sell:We()}),{handleSubmit:J,isSubmitting:$,resetForm:L}=aa({validationSchema:Z,initialValues:{name:"",performer:"",originalPrice:0,price:0,description:"",categoryCountry:"",categoryGroup:"",sell:!1}}),x=C("name"),G=C("date"),b=C("performer"),M=C("originalPrice"),k=C("price"),U=C("description"),T=C("categoryCountry"),A=C("categoryGroup"),R=C("sell"),P=J(async o=>{var l,a;try{i.value===""?await N.post("/tickets",{name:o.name,date:o.date,performer:o.performer,originalPrice:o.originalPrice,price:o.price,description:o.description,categoryCountry:o.categoryCountry,categoryGroup:o.categoryGroup,sell:o.sell}):await N.patch("/tickets/"+i.value,{name:o.name,date:o.date,performer:o.performer,originalPrice:o.originalPrice,price:o.price,description:o.description,categoryCountry:o.categoryCountry,categoryGroup:o.categoryGroup,sell:o.sell}),S({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),w(),I()}catch(y){console.log(y);const g=((a=(l=y==null?void 0:y.response)==null?void 0:l.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";S({text:g,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),h=m(10),F=m([{key:"createdAt",order:"desc"}]),p=m(1),f=m([]),n=[{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"演出日期",align:"center",sortable:!0,key:"date"},{title:"表演者",align:"center",sortable:!0,key:"performer"},{title:"原價",align:"center",sortable:!0,key:"originalPrice"},{title:"售價",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"categoryCountry"},{title:"性質",align:"center",sortable:!0,key:"categoryGroup"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],d=m(!0),u=m(0),c=m(""),V=async()=>{var o,l,a,y;d.value=!0;try{const{data:g}=await N.get("/tickets/my",{params:{page:p.value,itemsPerPage:h.value,sortBy:((o=F.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((l=F.value[0])==null?void 0:l.order)==="asc"?1:-1,search:c.value}});f.value.splice(0,f.value.length,...g.result.data),u.value=g.result.total}catch(g){console.log(g);const Q=((y=(a=g==null?void 0:g.response)==null?void 0:a.data)==null?void 0:y.message)||"發生錯誤，請稍後再試";S({text:Q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}d.value=!1};V();const I=()=>{p.value=1,V()};return(o,l)=>(re(),Ne(Y,null,[t(ue,{class:"pa-0 ma-0"},{default:s(()=>[t(X,{cols:"12",class:"pa-8"},{default:s(()=>[ua,t(ta)]),_:1}),t(ne,{class:"mx-auto",width:"80%"},{default:s(()=>[t(la,null,{default:s(()=>[t(ie,{value:"MyTickets"},{activator:s(({props:a})=>[t(ee,q(a,{title:"我的票券"}),null,16)]),default:s(()=>[t(ee,null,{default:s(()=>[t(ue,{class:"pt-2"},{default:s(()=>[t(X,{cols:"6"},{default:s(()=>[t(K,{color:"green",onClick:l[0]||(l[0]=a=>v())},{default:s(()=>[j("新增票券")]),_:1})]),_:1}),t(X,{cols:"6"},{default:s(()=>[t(D,{label:"搜尋","append-icon":"mdi-magnify",density:"comfortable",modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=a=>c.value=a),rounded:"",variant:"outlined","onClick:append":I,onKeydown:_e(I,["enter"])},null,8,["modelValue"])]),_:1}),t(X,{cols:"12"},{default:s(()=>[t(oa,{"items-per-page":h.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>h.value=a),V],"sort-by":F.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>F.value=a),V],page:p.value,"onUpdate:page":[l[4]||(l[4]=a=>p.value=a),V],items:f.value,headers:n,loading:d.value,"items-length":u.value,search:c.value,hover:""},{"item.sell":s(({item:a})=>[a.sell?(re(),qe(Ze,{key:0,icon:"mdi-check"})):ze("",!0)]),"item.edit":s(({item:a})=>[t(K,{icon:"mdi-pencil",variant:"text",color:"grey",onClick:y=>v(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ie,{value:"Admin"},{activator:s(({props:a})=>[t(ee,q(a,{title:"轉讓紀錄"}),null,16)]),_:1})]),_:1})]),_:1})]),_:1}),t($e,{modelValue:B.value,"onUpdate:modelValue":l[14]||(l[14]=a=>B.value=a),width:"500px"},{default:s(()=>[t(ea,{disabled:r($),onSubmit:Ee(r(P),["prevent"])},{default:s(()=>[t(ne,null,{default:s(()=>[t(Le,null,{default:s(()=>[j(Oe(i.value===""?"新增票券":"編輯票券"),1)]),_:1}),t(Ke,null,{default:s(()=>[t(D,{label:"演唱會名稱",modelValue:r(x).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>r(x).value.value=a),"error-messages":r(x).errorMessage.value},null,8,["modelValue","error-messages"]),t(D,{label:"演唱會日期",type:"date",modelValue:r(G).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>r(G).value.value=a),"error-messages":r(G).errorMessage.value},null,8,["modelValue","error-messages"]),t(D,{label:"表演者",modelValue:r(b).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>r(b).value.value=a),"error-messages":r(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(D,{label:"原始票價",type:"number",min:"0",modelValue:r(M).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>r(M).value.value=a),"error-messages":r(M).errorMessage.value},null,8,["modelValue","error-messages"]),t(D,{label:"售價",type:"number",min:"0",modelValue:r(k).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>r(k).value.value=a),"error-messages":r(k).errorMessage.value},null,8,["modelValue","error-messages"]),t(de,{label:"表演者國籍",items:z,modelValue:r(T).value.value,"onUpdate:modelValue":l[10]||(l[10]=a=>r(T).value.value=a),"error-messages":r(T).errorMessage.value},null,8,["modelValue","error-messages"]),t(de,{label:"表演者性質",items:E,modelValue:r(A).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>r(A).value.value=a),"error-messages":r(A).errorMessage.value},null,8,["modelValue","error-messages"]),t(ra,{label:"是否上架",modelValue:r(R).value.value,"onUpdate:modelValue":l[12]||(l[12]=a=>r(R).value.value=a),"error-messages":r(R).errorMessage.value},null,8,["modelValue","error-messages"]),t(sa,{label:"其他說明",modelValue:r(U).value.value,"onUpdate:modelValue":l[13]||(l[13]=a=>r(U).value.value=a),"error-messages":r(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(je,null,{default:s(()=>[t(Xe),t(K,{color:"red",disabled:r($),onClick:w},{default:s(()=>[j("取消")]),_:1},8,["disabled"]),t(K,{color:"green",type:"submit",loading:r($)},{default:s(()=>[j("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{xa as default};
